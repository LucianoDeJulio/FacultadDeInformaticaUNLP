programa CaminoSincronizado
areas
  casa1: AreaP(1,1,1,100)
  casa2: AreaP(4,1,4,100)
  casa3: AreaP(8,1,8,100)
  casaCoordinador: AreaP(5,5,5,5)
  deposito: AreaPC(10,10,10,10)
robots
  robot tipo1
  variables
    calleR:numero
    flores:numero
    papeles:numero
    avO:numero
    caO:numero
    seguir:boolean
  comenzar
    flores:=0
    papeles:=0
    avO:= PosAv
    caO:= PosCa
    repetir 5
      RecibirMensaje(calleR, robotCoordinador)
      BloquearEsquina(avO,calleR)
      Pos(avO,calleR)
      repetir 4
        mientras(HayFlorEnLaEsquina)
          tomarFlor
          flores:= flores + 1
        mientras(HayPapelEnLaEsquina)
          tomarPapel
          papeles:= papeles + 1
        mover
      Pos(avO,caO)
      LiberarEsquina(avO,calleR)
      EnviarMensaje(V, robotCoordinador)
      RecibirMensaje(seguir, robotCoordinador) {Aca terminaria la primera vuelta}
    EnviarMensaje(flores,robotCoordinador)
    EnviarMensaje(papeles,robotCoordinador)
    BloquearEsquina(10,10)
    Pos(10,10)
    mientras (HayFlorEnLaBolsa)
      depositarFlor
    mientras (HayPapelEnLaBolsa)
      depositarPapel
    Pos(avO, caO)
    LiberarEsquina(10,10)
  fin
  robot coordinador
  variables
    totF:numero
    totP:numero
    avO:numero
    caO:numero
    calleRR:numero
    seguir: boolean
    flores: numero
    papeles: numero
  comenzar
    avO:=PosAv
    caO:=PosCa
    totF:=0
    totP:=0
    BloquearEsquina(10,10){limpiar esquina}
    Pos(10,10)
    mientras (HayFlorEnLaEsquina)
      tomarFlor
    mientras (HayPapelEnLaEsquina)
      tomarPapel
    Pos(avO,caO)
    LiberarEsquina(10,10)
    repetir 5
      Random(calleRR, 1, 90)
      EnviarMensaje(calleRR, robot1)
      EnviarMensaje(calleRR, robot2)
      EnviarMensaje(calleRR, robot3)
      repetir 3
        RecibirMensaje(seguir, *) {cuando termina una vuelta}
      EnviarMensaje(V,robot1)
      EnviarMensaje(V,robot2)
      EnviarMensaje(V,robot3)
    repetir 3
      RecibirMensaje(flores, *)
      totF:= totF + flores
      RecibirMensaje(papeles, *)
      totP:= totP + papeles
    Informar('Total-flores', totF)
    Informar('Total-papeles', totP)
  fin
variables
  robot1: tipo1
  robot2: tipo1
  robot3: tipo1
  robotCoordinador: coordinador
comenzar
  AsignarArea(robot1, casa1)
  AsignarArea(robot2, casa2)
  AsignarArea(robot3, casa3)
  AsignarArea(robot1, deposito)
  AsignarArea(robot2, deposito)
  AsignarArea(robot3, deposito)
  AsignarArea(robotCoordinador, casaCoordinador)
  AsignarArea(robotCoordinador, deposito)  
  Iniciar(robot1, 1, 1)
  Iniciar(robot2, 4, 1)
  Iniciar(robot3, 8, 1)
  Iniciar(robotCoordinador, 5,5)
fin
